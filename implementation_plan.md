# 학생 식별/중복 제출 방지 및 학년 부장 관리 시스템 구현 계획

## 개요
가정통신문 배포 및 취합 시스템을 고도화하여, 정확한 학생 식별/중복 방지 뿐만 아니라 **학년 부장(전체 관리)** 및 **담임 교사(반별 독촉)**의 업무 효율을 극대화합니다.

## 제안된 변경 사항

### 1. 데이터베이스 (Supabase)
- **[NEW] `students` 테이블**:
    - `id`: UUID (Primary Key)
    - `grade`: Integer (학년)
    - `class_num`: Integer (반)
    - `student_num`: Integer (번호)
    - `name`: Text (학생 이름)
    - `dept`: Text (학과)
- **[MODIFY] `signatures` 테이블**:
    - `survey_response`: JSONB (항목별 선택 결과 저장, 예: `{"attendance": "attend"}`)
    - **제약 조건 추가**: `(doc_name, grade, class_num, student_num)` 유니크 제약 조건을 설정하여 중복 제출 원천 차단.

---

## 4. [NEW] 학년 부장 (Grade Head) 특별 기능
**"학년 전체를 지휘하는 관제탑"**

**학년 부장님**은 **학년 전체의 흐름**을 모니터링하고 일괄 배포를 담당하며, **담임 선생님**은 자기 반의 **세부 독촉**을 담당합니다.

### 4.1. 학년 일괄 배포 시스템
*   **원클릭 전파**: 학년 부장이 `[2학년 전체]` 대상으로 문서를 올리면, **2학년 1반부터 15반까지 모든 반의 대시보드**에 해당 문서가 자동으로 '긴급 취합 항목'으로 등록됩니다.
*   **마스터 링크 (Master Link)**:
    *   각 반마다 다른 링크를 만들 필요 없이, **`gatong.com/2026/2학년/통합`** 링크 하나만 생성.
    *   이 링크를 학년 공지방에 뿌리면, 학생 접속 시 **"몇 반인가요?"**를 먼저 묻고 해당 반의 서명부로 자동 연결됩니다.

### 4.2. 학년 통계 대시보드 (Grade Dashboard)
*   **반별 경쟁 현황판**:
    *   1반(95%), 2반(40%), 3반(88%)... 처럼 **반별 제출율을 그래프**로 한눈에 비교.
    *   제출율이 저조한 반이 어딘지 파악하여 해당 담임 선생님께 지원 요청 가능.
*   **미제출자 전체 오버뷰**:
    *   "현재 2학년 전체 300명 중 45명 미제출" 같은 거시적 통계 제공.

---

### 2. 프론트엔드 컴포넌트 (`src/components`)

#### [MODIFY] `SignatureModal.tsx`
- **학생 선택 로직**: 직접 타이핑 대신 학년/반 선택 시 해당 학급 학생 목록(DB 조회)을 드롭다운으로 표시.
- **[REQUIRED] 핵심 실수 방지 장치**:
    1. **개인 식별 코드 (비밀번호)**: [가장 중요] 담임 선생님이 부여한 학생별 고유 비밀번호(예: 생일 4자리 등)를 입력해야만 제출 가능.
    2. **2단계 확인 (Double Confirmation)**: 비밀번호 입력 후 "OOO 학생이 맞습니까?" 최종 확인 팝업 표시.
    3. **제출 이력 체크**: 이미 제출한 학생은 목록에서 비활성화 처리하거나 선택 시 즉시 경고.
    4. **브라우저 기억 (Sticky Identity)**: 한 번 인증에 성공한 기기는 학년/반/번호 정보를 로컬 저장소에 기억하여 재입력 수고 절감.
- **설문 항목**: 문서 제목에 '참가', '신청', '희망' 등 키워드가 포함된 경우 해당 선택지(라디오 버튼 등) 자동 생성.

#### [NEW] `StudentSelector.tsx`
- 학년, 반, 이름을 단계별로 선택하거나 검색할 수 있는 입력 컴포넌트.

---

### 3. 관리자 페이지 (`src/app/admin`)

#### [NEW] `page.tsx` (대시보드)
- 전체 문서 목록 및 문서별 제출 통계 요약.
- 내비게이션 바: [내 반 관리] | [학년 통계(부장용)] 탭 구분.

#### [NEW] `GradeDashboard.tsx`
- 학년 전체 통계 및 반별 제출율 시각화 그래프.

---

---

## 6. 담당 교사 업무 매뉴얼 (Standard Operating Procedure)

### 6.1. 문서 제작 (Creation)
*   **"절취선 삭제"**: 디지털 서명으로 대체되므로, HWP 파일 하단의 가위표(절취선) 및 회신서 양식은 작성하지 않습니다.
*   **"PDF 저장 필수"**: 모바일 호환성을 위해 HWP 작성 후 반드시 `PDF로 저장`하여 업로드합니다.
*   **"Full Color"**: 흑백 인쇄 비용 제약이 없으므로, 사진/도표 등을 적극 활용합니다.

### 6.2. 파일명 규칙 (Naming Convention)
파일명만 잘 지으면 시스템이 설정을 자동화합니다.
*   형식: `[대상학년/학과] 제목 (성격)`
*   예시 1: `[2학년] 수학여행 참가 동의서 (신청).pdf` -> **2학년 필터 + 서명 기능 ON**
*   예시 2: `[전체] 미세먼지 대응 요령 (안내).pdf` -> **전체 필터 + '확인했습니다' 버튼만 노출**

### 6.3. 업로드 프로세스 (Smart Wizard)
1.  **Drag & Drop**: 관리자 페이지에 PDF 파일을 드래그합니다.
2.  **지능형 제안 (AI Suggestion)**: 파서가 파일명을 분석하여 "이 문서는 [2학년] [반도체과] 대상, [서명]이 필요한 문서가 맞습니까?"라고 묻습니다.
3.  **설문 옵션 클릭**: 서명 외에 추가 질의가 필요한 경우 (예: 도시락 메뉴 A/B), '객관식 항목 추가' 버튼을 눌러 설정합니다.
### 6.4. 수정 및 재제출 정책 (Correction Policy)
학부모나 학생이 실수로 잘못 선택(예: 참석 -> 불참)하여 제출한 경우를 대비한 유연한 수정 로직입니다.

1.  **재제출 허용 (Re-submission)**:
    *   학생이 다시 접속하여 [확인 및 서명]을 누르면, 시스템이 "이미 2026-03-05에 제출된 내역이 있습니다. 수정하시겠습니까?" 묻습니다.
    *   **덮어쓰기 (Overwrite)**: 새로운 서명과 선택값으로 기존 데이터를 업데이트합니다. (단, 마감 기한 전까지만 가능)
2.  **이력 관리 (Audit Log)**:
    *   DB에는 기존 제출 내용을 바로 지우지 않고 `history` 테이블에 백업하거나, `updated_at` 타임스탬프를 찍어 **"누가, 언제, 무엇을 수정했는지"** 기록을 남깁니다. (분쟁 예방)
3.  **담임 선생님 알림**:
    *   이미 취합 완료된 건이 수정되면 담임 선생님 대시보드에 **[수정됨]** 뱃지가 표시되어 변동 사항을 놓치지 않게 합니다.
