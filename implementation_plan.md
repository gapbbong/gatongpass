# 학생 식별 및 중복 제출 방지 시스템 구현 계획

## 개요
가정통신문 제출 시 학생을 명확히 식별하고, 중복 제출을 방지하며, 항목별 설문 결과를 자동으로 집계하는 기능을 추가합니다.

## 제안된 변경 사항

### 1. 데이터베이스 (Supabase)
- **[NEW] `students` 테이블**:
    - `id`: UUID (Primary Key)
    - `grade`: Integer (학년)
    - `class_num`: Integer (반)
    - `student_num`: Integer (번호)
    - `name`: Text (학생 이름)
    - `dept`: Text (학과)
- **[MODIFY] `signatures` 테이블**:
    - `survey_response`: JSONB (항목별 선택 결과 저장, 예: `{"attendance": "attend"}`)
    - **제약 조건 추가**: `(doc_name, grade, class_num, student_num)` 유니크 제약 조건을 설정하여 중복 제출 원천 차단.

---

### 2. 프론트엔드 컴포넌트 (`src/components`)

#### [MODIFY] `SignatureModal.tsx`
- **학생 선택 로직**: 직접 타이핑 대신 학년/반 선택 시 해당 학급 학생 목록(DB 조회)을 드롭다운으로 표시.
- **[REQUIRED] 핵심 실수 방지 장치**:
    1. **개인 식별 코드 (비밀번호)**: [가장 중요] 담임 선생님이 부여한 학생별 고유 비밀번호(예: 생일 4자리 등)를 입력해야만 제출 가능.
    2. **2단계 확인 (Double Confirmation)**: 비밀번호 입력 후 "OOO 학생이 맞습니까?" 최종 확인 팝업 표시.
    3. **제출 이력 체크**: 이미 제출한 학생은 목록에서 비활성화 처리하거나 선택 시 즉시 경고.
    4. **브라우저 기억 (Sticky Identity)**: 한 번 인증에 성공한 기기는 학년/반/번호 정보를 로컬 저장소에 기억하여 재입력 수고 절감.
- **설문 항목**: 문서 제목에 '참가', '신청', '희망' 등 키워드가 포함된 경우 해당 선택지(라디오 버튼 등) 자동 생성.

#### [NEW] `StudentSelector.tsx`
- 학년, 반, 이름을 단계별로 선택하거나 검색할 수 있는 입력 컴포넌트.

---

### 3. 관리자 페이지 (`src/app/admin`)

#### [NEW] `page.tsx` (대시보드)
- 전체 문서 목록 및 문서별 제출 통계 요약 (전체 22명 중 N명 제출).
- 미제출자 명단 자동 추출 및 표시.
- 항목별(참석/불참 등) 통계 그래프 및 요약.
- 제출 결과 CSV 다운로드 기능.

---

## 검증 계획

### 자동화 테스트
- Supabase SQL Editor에서 유니크 제약 조건이 의도대로 작동하는지 테스트 (동일 학번 중복 Insert 시도).

### 수동 검증
1. **학생 모드**:
    - 특정 문서의 서명 모달 접속.
    - 학년/반 선택 후 드롭다운에서 학생 이름 선택 확인.
    - 설문 항목(참석/불참) 선택 및 서명 후 제출.
    - 동일 학생으로 다시 제출 시도 시 "이미 제출되었습니다" 팝업 확인.
2. **관리자 모드**:
    - `/admin` 접속 후 방금 제출한 내역이 실시간으로 집계되는지 확인.
    - 미제출자 목록에 해당 학생이 사라졌는지 확인.
